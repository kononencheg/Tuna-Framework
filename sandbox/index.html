<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ya="http://yatalant.ru/namespace">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

		<title>TUNA SANDBOX</title>

		<script type="text/javascript" src="../js/tuna.js"></script>

		<link href="../css/common.css" rel="stylesheet" type="text/css"/>
	</head>

	<body>
		<!-- Элементы отрисовки списков -->
		<div style="/*display: none;*/">

			<!-- 
				TODO: Подумать над свичем
			-->
			<div id="tab_switcher">
				<ya:switcher />

				<ya:renderer ya:item="tab_1" ya:test="id=0" />

				<ya:renderer ya:item="tab_2"
							 ya:test="id=1" />

				<div id="tab_1">1</div>
				<div id="tab_2">2</div>
			</div>

			<!-- Строка трыблиы -->
			<div id="table_renderer">
				<ya:renderer ya:item="table_renderer_item" />

				<ya:spot ya:target="user_id"
						 ya:bind="id" />

				<ya:spot ya:target="first_name"
						 ya:bind="firstName" />

				<ya:spot ya:target="last_name"
						 ya:bind="lastName" />

				<table border="1">
					<tbody>
						<tr id="table_renderer_item">
							<td>
								<span id="user_id"></span>
							</td>
							<td>
								<span id="first_name"></span>
							</td>
							<td>
								<span id="last_name"></span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		
		<!-- Консосль вывода отладочных сообщений -->
		<div id="console" class="Console"></div>

		<!-- Загруза скриптов и установка глобальных переменных -->
		<script type="text/javascript">
		//<![CDATA[
			/////////////////////////////////////////////////////////////////////////////
			//	Загрузка зависимостей
			/////////////////////////////////////////////////////////////////////////////

			tuna.MERGE_URI = "../" + tuna.MERGE_URI;
			tuna.JS_ROOT = "../" + tuna.JS_ROOT;

			tuna.includeMerged
			([
				"tuna.debug.TextNodeWriter",
				"tuna.debug.Logger",
				"tuna.ya.YaTransformer"
			]);

			tuna.debug.logger.setWriter(new TextNodeWriter("console"));
			
			/////////////////////////////////////////////////////////////////////////////
			//	Сценарии
			/////////////////////////////////////////////////////////////////////////////

			var data = 
			{
				users:
				[
					{
						id: 1,
						firstName: "Сергей",
						lastName: "Кононенко"
					},
					{
						id: 2,
						firstName: "Душан",
						lastName: "Василевски"
					},
					{
						id: 3,
						firstName: "Сергей",
						lastName: "Третьяк"
					}
				]
			};

			var data2 =
			{
				users:
				[
					{
						id: 1,
						firstName: "$$$",
						lastName: "$$$"
					},
					{
						id: 2,
						firstName: "@@@",
						lastName: "@@@"
					},
					{
						id: 3,
						firstName: "%%%",
						lastName: "%%%"
					},
					{
						id: 4,
						firstName: "&&&",
						lastName: "&&&"
					}
				]
			};
		//]]>
		</script>

		<div id="some_text">

			<!-- Установка атрибутов с помощью привязки  ya:attribute="" -->
			<ya:spot ya:target="count"
					 ya:bind="users.length" />

			<ya:spot ya:target="first_user_name"
					 ya:bind="users.0.firstName" />

			<!--
				ya:key - Привязка элемента к уникальному идентификатору элемента в наборе
				данных.
			-->
			<ya:list ya:target="users_list" 
					 ya:bind="users" ya:key="id"
					 ya:renderer="table_renderer" />

			Count: <span id="count">0</span>
			<br />
			First user name: <span id="first_user_name">?</span>

			<table border="1">
				<thead>
					<tr>
						<th>#</th>
						<th>First Name</th>
						<th>Last Name</th>
					</tr>
				</thead>

				<tbody id="users_list">
					<tr id="users_list:1">
						<td>
						   <span id="users_list:1.user_id">1</span>
						</td>
						<td>
							<span id="users_list:1.first_name">Sergey</span>
						</td>
						<td>
							<span id="users_list:1.last_name">Kononenko</span>
						</td>
					</tr>
					<tr id="users_list:2">
						<td>
							<span id="users_list:2.user_id">2</span>
						</td>
						<td>
							<span id="users_list:2.first_name">Dushan</span>
						</td>
						<td>
							<span id="users_list:2.last_name">Vasilevski</span>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<script type="text/javascript">
		//<![CDATA[
			
			var yt = new YaTransformer("some_text");
			yt.transform(data);
			
		//]]>
		</script>

		<button onclick="yt.transform(data2);">Refresh</button>

	</body>
</html>
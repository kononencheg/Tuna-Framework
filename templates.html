<!DOCTYPE html>
<html xmlns:tuna>
    <head>
        <meta charset="utf-8">

        <title>Tuna Templates</title>

        <link rel="stylesheet" href="css/prettify.css" />
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/styles.css">
    </head>

    <body>
        <a href="https://github.com/kononencheg/Tuna-Templates">
            <img class="fork-me-ribbon" src="http://goo.gl/O5hru"
                 alt="Fork me on GitHub">
        </a>

        <div class="container">
            <div class="page-header span4">

                <h1>
                    Tuna Templates <br/>
                    <small>Быстрый шаблонизатор.</small>
                </h1>

                <hr />

                <div class="well">
                    <ul class="nav nav-list">
                        <li class="nav-header">Навигация</li>

                        <li><a href="#benefits">Преимущества</a></li>

<li><a href="#benchmarks">Тесты скорости</a></li>

<li><a href="#hello-world">Пример использования</a></li>

<li><a href="#tags">Теги разметки</a></li>

<li><a href="#path">Язык выбора данных</a></li>


                        <li class="divider"></li>

                        <li class="nav-header"><a href="index.html">Tuna Framework</a></li>

                        <li><a href="common.html">Tuna Common</a></li>
                        <li><a href="templates.html">Tuna Templates</a></li>
                        <li><a href="#mvc.html">Tuna MVC</a></li>

                        <li class="divider"></li>

                        <li class="nav-header">Примеры приложений</li>
                        <li><a href="todo-list.html">Список задач</a></li>

                    </ul>
                </div>

                <hr />

                <address>
                    <strong>Сергей Кононенко</strong><br>
                    <a href="mailto:kononencheg@gmail.com">
                        kononencheg@gmail.com
                    </a>
                </address>
            </div>

            <div class="row">
                <div class="span7 offset5">
                    <h2><a name="benefits"></a> Преимущества</h2><hr />

<div>
    
<p>
    Tuna Tempaltes является частью библиотеки Tuna Framework, и предоставляет
    широкий функционал для отображения данных в браузере. Его основными плюсами
    являются:
</p>

<ol class="paragraph-list">
    <li>
        <strong>Скорость</strong> - Tuna Templates работает очень быстро, так
        как обновляeтся отображение только изменившихся данных.
    </li>
    <li>
        <strong>Сохранность DOM-дерева</strong> - при отображении данных ссылки
        на DOM-элементы и слушатели событий сохраняются.
    </li>
    <li>
        <strong>Независимоcть</strong> - для работы шаблонизатору требуется
        только <a href="#comnon.html">Tuna Common</a>.
    </li>
</ol></div>

<h2><a name="benchmarks"></a> Тесты скорости</h2><hr />

<div>
    <p>
    Тесты для сравнения скорости:
</p>

<ul class="paragraph-list">
    <li>
        <a href="http://jsperf.com/tuna-templates-vs-inner-html" target="_blank">Tuna Templates VS Inner HTML</a>
        - сравнение скорости шаблонизатора со вставкой строки контента.
    </li>
    <li>
        <a href="http://jsperf.com/tuna-templates-vs-mustache-vs-pure-vs-underscore" target="_blank">Tuna Templates VS Mustache VS Pure VS Underscore</a>
        - сравнение скоростей популярных шаблонизаторов.
    </li>
</ul></div>

<h2><a name="hello-world"></a> Пример использования</h2><hr />

<div>
    
<p>
    Для использования Tuna Templates практически нет необходимости
    менять готовую верстку. Для примера возьмем разметку информации
    пользователя из одной популярной соц. сети:
</p>

<pre class="prettyprint linenums"><code>&lt;div id="user_info"&gt;
    &lt;a class="avatar" href&gt;
        &lt;img width="50" height="50" /&gt;
    &lt;/a&gt;
    &lt;div class="name"&gt;
        &lt;a href="#"&gt;
            &lt;span&gt;First Name&lt;/span&gt;
            &lt;br/&gt;
            &lt;small&gt;Last Name&lt;/small&gt;
        &lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>

<p>
    Выберем формат данных для вставки, например:
</p>

<pre class="prettyprint linenums"><code>{
    "firstName": "...",
    "lastName": "...",
    "avatarUrl": "http://..."
}</code></pre>

<p>
    Далее необходимо отметить элементы, в которых будут отображаться
    данные. Для отметки используем специальные CSS-классы
    (удобно начинать их с префиксом <code>t-</code>):
</p>

<pre class="prettyprint linenums"><code>&lt;div id="user_info"&gt;
    &lt;a class="avatar" href&gt;
        &lt;img class="<b>t-avatar</b>" width="50" height="50" /&gt;
    &lt;/a&gt;
    &lt;div class="name"&gt;
        &lt;a href="#"&gt;
            &lt;span class="<b>t-first-name</b>" &gt;&lt;/span&gt;
            &lt;br/&gt;
            &lt;small class="<b>t-last-name</b>"&gt;&lt;/small&gt;
        &lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>

<p>
    Затем необходимо задать правило, указывающее на то как данные
    должны отображаться. Для задания правила используется специальная
    XML разметка.
</p>

<div class="alert alert-danger">
    <h4 class="alert-heading">Внимание!</h4>

    <p>
        Для того чтобы специальная разметка работала в IE тег
        <code>html</code> должен содержать аттрибут <code>xmlns:tuna</code>.
    </p>

    Вот так: <code>&lt;html xmlns:tuna&gt; ... &lt;/html&gt;</code>
</div>

<p>
    Добавим на страницу приложения спрятанный контейнер со следующим
    содержанием:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:template id="user_template"&gt;

    &lt;tuna:spot tuna:target="<b>t-last-name</b>" tuna:path="<b>lastName</b>" /&gt;

    &lt;tuna:spot tuna:target="<b>t-first-name</b>" tuna:path="<b>firstName</b>" /&gt;

    &lt;tuna:attr tuna:target="<b>t-avatar</b>" tuna:path="<b>avatarUrl</b>"
               tuna:name="<b>src</b>" /&gt;

&lt;/tuna:template&gt;</code></pre>

<p>
    Данная разметка представляет собой правило распределения данных,
    по сути - шаблон. Шаблон состоит из следующих частей.
</p>

<p>
    Объявление шаблона с идентификатором <code>user_template</code>.
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:template id="user_template"&gt; ... &lt;/tuna:template&gt;</code></pre>

<p>
    Объявление <em>точки</em> для вставки данных - в
    <code>innerHTML</code> элемента с классом <code>t-last-name</code>
    вставить свойство <code>lastName</code>.
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:spot tuna:target="<b>t-last-name</b>" tuna:path="<b>lastName</b>" /&gt;</code></pre>

<p>
    Объявление аттрибута для вставки данных - в аттрибут
    <code>src</code> элемента с классом <code>t-avatar</code>
    вставить свойство <code>avatarUrl</code>.
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:attr tuna:target="<b>t-avatar</b>" tuna:path="<b>avatarUrl</b>"
           tuna:name="<b>src</b>" /&gt;</code></pre>


<p>
    Теперь код для того чтобы шаблон заработал:
</p>

<pre class="prettyprint linenums"><code>// Устанавливаем движок CSS-селекторов
tuna.dom.setSelectorEngine(jQuery.find);

// Элемент для отображения данных
var templateContainer = document.getElementById('user_info');

// Создание шаблона из разметки
var tunaTemplate =
    tuna.tmpl.compileFromMarkup(templateContainer, 'user_template');

// Отображение данных
tunaTemplate.processTransform({
    "firstName": "Sergey",
    "lastName": "Kononenko",
    "avatarUrl": "http://goo.gl/2pRFN"
});</code></pre>

<p>
    <a name="example"></a>

    Вот и все! Теперь можно посмотреть на то, как это работает
    (<a href="javascript: void(0);" onclick="example();">запустить</a>):
</p>


<div class="well" id="user_info">
    <p class="avatar">
        <img class="t-avatar" width="50" height="50" />
    </p>
    <div class="name">
        <a href="#example">
            <span class="t-first-name">First Name</span>
            <br/>
            <small class="t-last-name">Last Name</small>
        </a>
    </div>
</div></div>

<h2><a name="tags"></a> Теги разметки</h2><hr />

<div>
    
<p>
    В качестве примера, при описании тегов и языка запроса данных
    шаблонизатора будет использоваться набор данных следующего вида:
</p>

<pre class="prettyprint linenums"><code>{ "users": [
    { "name": "Сергей Кононенко",
       "isSelected": true,
       "imageUrl": "http://goo.gl/2pRFN" },
    { "name": "Милый котик",
       "isSelected": true,
       "imageUrl": "http://goo.gl/RHuA3" }
]}</code></pre>

<p>
    Для разметки шаблона Tuna Templates существуют следующие теги:
</p>


<h3>
    <a name="tuna:template"></a> tuna:template
</h3>

<p>
    Тег разметки шаблона, все остальные теги расположены в теле этого тега.
    Необходимые аттрибуты:
</p>

<ul class="paragraph-list">
    <li>
        <code>id</code> - идентификатор шаблона, необходим для получения
        разметки данных из верстки.
    </li>
</ul>

<p>
    <strong>Пример:</strong> объявление шаблона с идентификатором <code>template_id</code>:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:template id="template_id"&gt;
    &lt;!-- теги разметки --&gt;
&lt;/tuna:template&gt;</code></pre>

<h3>
    <a name="tuna:spot"></a>  tuna:spot
</h3>

<p>
    Тег объявления DOM-элемента для отображения данных во внутренней разметке.
    Должен содержать следующие аттрибуты:
</p>

<ul class="paragraph-list">
    <li>
        <code>tuna:target</code> - имя CSS-класса DOM-элементов, в
        разметке которых необходимо отобразить данные.
    </li>
    <li>
        <code>tuna:path</code> - путь выбоки данных, например: <code>/users/length</code>.
        <a href="#path">Подробнее...</a>
    </li>
</ul>

<p>
    <strong>Пример:</strong> у всех элементов с CSS-классом <code>t-second-user</code>
    будут отображать имя второго пользователя в массиве <code>users</code>:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:spot tuna:target="t-second-user" tuna:path="users/1/name" /&gt;</code></pre>

<h3>
    <a name="tuna:attr"></a> tuna:attr
</h3>


<p>
    Тег объявления DOM-элемента для установки данных в аттрибут элемента.
    Должен содержать теже аттрибуты, что и тег <a href="#tuna:spot">tuna:spot</a>, и
    дополнительно:
</p>

<ul class="paragraph-list">
    <li>
        <code>tuna:name</code> - имя аттрибута, в который должны устанавливаться
        данные.
    </li>
</ul>

<p>
    <strong>Пример:</strong> у всех элементов с CSS-классом <code>t-second-user-picture</code>
    в аттрибут <code>src</code> будет установленно значение поля <code>imageUrl</code>
    второго пользователя в массиве:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:attr tuna:target="t-second-user-picture"
           tuna:path="users/1/imageUrl"
           tuna:name="src" /&gt;</code></pre>

<h3>
    <a name="tuna:checkbox"></a> tuna:checkbox
</h3>

<p>
    Тег объявления DOM-элемента <code>INPUT</code> типа <code>checkbox</code>
    для установки аттрибута <code>checked</code> в зависимости от переданных
    данных:
</p>

<ul class="paragraph-list">
    <li>
        В том случае если в качестве данных передан <strong>массив</strong>,
        выделены те элементы, аттрибут <code>name</code>, которых найден среди
        элементов массива.
    </li>
    <li>
        Если в качестве данных передано <strong>булево значение</strong> оно
        будет определять выделенность всех элементов.
    </li>
    <li>
        Во всех остальных случаях будут выделены те элементы аттрибут
        <code>name</code>, которых совпадает со строковым представлением данных.
    </li>
</ul>

<p>
    Должен содержать теже аттрибуты, что и тег <a href="#tuna:spot">tuna:spot</a>
</p>

<p>
    <strong>Пример:</strong> у всех элементов с CSS-классом <code>t-second-selection</code>
    будет устанавливаться выделенность в зависимости от значения поля <code>isSelected</code>
    первого пользователя в массиве:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:checkbox tuna:target="t-user-selection"
               tuna:path="users/0/isSelected" /&gt;</code></pre>

<h3>
    <a name="tuna:if"></a> tuna:if
</h3>


<p>
    Тег объявления условия в зависимости от выполнения которого, будет
    выполняться определенное действие с выбранными DOM-элементами.
</p>

<p>
    Должен содержать теже аттрибуты, что и тег <a href="#tuna:spot">tuna:spot</a>,
    а также один из возможных аттрибутов условия и один - действия с элементом.
</p>

<p>
    Возможные аттрибуты условия:
</p>

<ul class="paragraph-list">
    <li>
        <code>tuna:eq</code> - условие равенства строковых значений данных и
        указанного в аттрибуте значения.
    </li>
    <li>
        <code>tuna:ne</code> - условие неравенства строковых значений данных и
        указанного в аттрибуте значения.
    </li>
    <li>
        <code>tuna:isset</code> - условие наличия данных по заданному пути.
    </li>
    <li>
        <code>tuna:notset</code> - условие отсутствия данных по заданному пути.
    </li>
</ul>


<div class="alert alert-info">
    <h4 class="alert-heading">Информация!</h4>

    <p>
        Аттрибуты условий <code>tuna:isset</code> и <code>tuna:notset</code>
        могут указываться с отсутствующим значением.
    </p>

    Вот так: <code>&lt;tuna:if ... tuna:isset ... /&gt;</code>
</div>


<p>
    Возможные аттрибуты действия:
</p>

<ul class="paragraph-list">
    <li>
        <code>tuna:class</code> - установка CSS-класса при успешном результате
        проверки условия и удаление, при провале.
    </li>
</ul>

<p>
    <strong>Пример:</strong> всем элементам с CSS-классом <code>t-hide-if-selected</code>
    будет устанавливаться CSS-класс <code>hide</code> в том случае если значение поля
    <code>isSelected</code> первого пользователя в массиве будет равно <code>true</code>:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:if tuna:target="t-not-selected"
         tuna:path="users/0/isSelected" tuna:eq="true"
         tuna:class="hide" /&gt;</code></pre>

<h3>
    <a name="tuna:list"></a> tuna:list
</h3>

<p>
    Тег объявления DOM-элемента отображения списка соотвествующего выбранным данным.
    Для отображения списка необходим DOM-элемент <em>прототип</em> элемента списка и
    шаблон для отображения данных в элементе.
</p>

<p>
    Тег спсика должен содержать теже аттрибуты, что и тег
    <a href="#tuna:spot">tuna:spot</a>, а также:
</p>

<ul class="paragraph-list">
    <li>
        <code>tuna:item-renderer-id</code> - идентификатор прототипа элемента списка.
    </li>
    <li>
        <code>tuna:item-tempalte-id</code> - идентификатор шаблона элемента списка.
    </li>
    <li>
        <code>tuna:key-path</code> - путь данных к ключу элемента в списке.
        При перерисовке списка элементы не создаются заново, поэтому каждый
        элемент должен иметь уникальный ключ. Практически всегда достаточно в
        качестве пути к ключу указывать индекс элемента - <code>$key</code>.
    </li>
</ul>

<p>
    <strong>Пример:</strong> во всех элементов с CSS-классом <code>t-users-list</code>
    отобразить список имен пользователей:
</p>

<pre class="prettyprint linenums"><code>&lt;tuna:template id="list_template"&gt;
    &lt;tuna:list tuna:target="t-users-list" tuna:path="users"
               tuna:item-renderer-id="users_list_item"
               tuna:item-tempalte-id="user_template"
               tuna:key-path="$key" /&gt;
&lt;/tuna:template&gt;

&lt;tuna:template id="user_template"&gt;
    &lt;tuna:spot tuna:target="t-name" tuna:path="name" /&gt;
&lt;/tuna:template&gt;

&lt;ul&gt;
    &lt;li id="users_list_item" class="t-name"&gt;&lt;/li&gt;
&lt;/ul&gt;</code></pre>


</div>

<h2><a name="path"></a> Язык выбора данных</h2><hr />

<div>
    
<p>
    Для описания пути выбора данных в исходном наборе используется специальный
    язык запросов, он похож на сильно упрощенный
    <a href="http://www.w3.org/TR/xpath/" target="_blank">XPath</a>.
</p>

<p>
    Запрос выбора данных (<em>путь</em>) представляет собой последовательность
    <em>шагов адресации</em> разделенных косой чертой. Например:
</p>

<pre><code>users/0/name/length</code></pre>

<p>
    Данный запрос выберет количество символов в имени первого пользователя в
    массиве.
</p>

<p>
    Путь может быть как абсолютный так и относительный. Например, чтобы отобразить
    в элементе списка получить общее число пользователей, можно использовать
    абсолютный путь:
</p>

<pre><code>/users/length</code></pre>

<p>
    Основным типом шага адресации является ключ элемента данных в текущем
    контексте. Кроме ключа элемента существуют следующие шаги:
</p>

<ul class="paragraph-list">
    <li>
        <code>"$key"</code> - имя текущего ключа элемента данных. Данный шаг
        полезен при получении ключа элемента в списке.
    </li>
    <li>
        <code>".."</code> - возвращение к предыдущему контексту. Например, чтобы
        получить ключ предыдущего контекста можно использовать следующий путь: <code>"../$key"</code>.
    </li>
    <li>
        <code>"."</code> - взятие значения текущего контекста.
    </li>
</ul>
</div>


                    <hr />
                </div>
            </div>
        </div>

        
<div style="display: none;">
    <tuna:template id="user_template">

        <tuna:spot tuna:target="t-last-name" tuna:path="lastName" />

        <tuna:spot tuna:target="t-first-name" tuna:path="firstName" />

        <tuna:attr tuna:target="t-avatar" tuna:path="avatarUrl"
                   tuna:name="src" />

    </tuna:template>
</div>

<script src="js/prettify.js"></script>
<script>
    prettyPrint();
</script>

<script src="js/json.js"></script>
<script src="js/sizzle.js"></script>
<script src="js/tuna-common.js"></script>
<script src="js/tuna-templates.js"></script>

<script>

    // Устанавливаем движок CSS-селекторов
    tuna.dom.setSelectorEngine(Sizzle);

    // Элемент для отображения данных
    var templateContainer = document.getElementById('user_info');

    // Создание шаблона из разметки
    var tunaTemplate =
            tuna.tmpl.compileFromMarkup(templateContainer, 'user_template');

    function example() {
        // Отображение данных
        tunaTemplate.processTransform({
            "firstName": "Sergey",
            "lastName": "Kononenko",
            "avatarUrl": "http://goo.gl/2pRFN"
        });
    }

</script>

    </body>
</html>
